<%= javascript_include_tag 'application', 'prefilled_input' %>

<%= render 'shared/kissmetrics' %>

<%= yield :javascript %>

<% if Rails.env.production? %>
  <%= render 'shared/google_analytics' %>
  <script src="//d1nu2rn22elx8m.cloudfront.net/performable/pax/3tbRq2.js" type="text/javascript"></script>
<% end %>

<% if Rails.env.test? || Rails.env.cucumber? %>
  <%= javascript_tag do %>
    jQuery.fx.off = true;
    $.ajaxSetup({ async: false });
  <% end %>
<% end %>
<%= javascript_tag do %>
  function tumblr(resp) {
    var posts = resp.posts;
    $('#blog-footer .loading').replaceWith('<ul/>');
    var $ul = $('#blog-footer ul');
    for (var i=0; i<posts.length; i++) {
      var p = posts[i];
      var title = p['regular-title'] || p['link-text'] || null;
      if (title) {
        $ul.append('<li><a href="'+p['url']+'">'+title+'</a></li>');
      }
    }
  }
<% end %>

<script type="text/javascript">
  <% Split::Experiment.all.each do |experiment| %>
    _kmq.push(['set', { '<%= experiment.name %>': '<%= ab_test(experiment.name, *experiment.alternative_names) %>' }]);
  <% end %>
</script>
