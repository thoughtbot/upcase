<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Getting Started With Rails</title>
	<!--[if lt IE 8]>
	<script src="http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE8.js" type="text/javascript"></script>
	<![endif]-->
	<link href="stylesheets/base.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="stylesheets/forms.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="stylesheets/more.css" media="screen" rel="Stylesheet" type="text/css" />
	<style type="text/css">
		div#container {
	max-width: 900px;
	padding-bottom: 3em;
}

div#content {
	margin-left: 200px;
}

div#container.notoc {
	max-width: 600px;
}

.notoc div#content {
	margin-left: 0;
}

pre {
	line-height: 1.4em;
}

#content p tt {
	background: #eeeeee;
	border: solid 1px #cccccc;
	padding: 3px;
}

dt {
	font-weight: bold;
}

#content dt tt {
	font-size: 10pt;
}

dd {
	margin-left: 3em;
}

#content dt tt, #content pre tt {
	background: none;
	padding: 0;
	border: 0;
}

#content .olist ol {
	margin-left: 2em;
}

#header {
	position: relative;
	max-width: 840px;
	margin-left: auto;
	margin-right: auto;
}

#header.notoc {
	max-width: 580px;
}

#logo {
	position: absolute;
	left: 10px;
	top: 10px;
	width: 110px;
	height: 140px;
}

div#header h1#site_title {
	background: url('images/ruby_on_rails_by_mike_rundle2.gif') top left no-repeat;
	position: absolute;
	width: 392px;
	height: 55px;
	left: 145px;
	top: 20px;
	margin: 0;
	padding: 0;
}

#site_title span {
	display: none;
}

#site_title_tagline {
	display: none;
}

ul#navMain {
	position: absolute;
	margin: 0;
	padding: 0;
	top: 97px;
	left: 145px;
}

.left-floaty, .right-floaty {
	padding: 15px;
}

.admonitionblock,
.tableblock {
	margin-left: 1em;
	margin-right: 1em;
	margin-top: 0.25em;
	margin-bottom: 1em;
}

.admonitionblock .icon {
	padding-right: 8px;
}

.admonitionblock .content {
	border: solid 1px #ffda78;
	background: #fffebd;
	padding: 10px;
	padding-top: 8px;
	padding-bottom: 8px;
}

.admonitionblock .title {
	font-size: 140%;
	margin-bottom: 0.5em;
}

.tableblock table {
	border: solid 1px #aaaaff;
	background: #f0f0ff;
}

.tableblock th {
	background: #e0e0e0;
}

.tableblock th,
.tableblock td {
	padding: 3px;
	padding-left: 5px;
	padding-right: 5px;
}

.sidebarblock {
	margin-top: 0.25em;
	margin: 1em;
	border: solid 1px #ccccbb;
	padding: 8px;
	background: #ffffe0;
}

.sidebarblock .sidebar-title {
	font-size: 140%;
	font-weight: 600;
	margin-bottom: 0.3em;
}

.sidebarblock .sidebar-content > .para:last-child > p {
	margin-bottom: 0;
}

.sidebarblock .sidebar-title a {
	text-decoration: none;
}

.sidebarblock .sidebar-title a:hover {
	text-decoration: underline;
}

	</style>
</head>
<body>
	<div id="header" >
		<div id="logo">
			<a href="index.html" title="Ruby on Rails"><img src="images/rails_logo_remix.gif" alt="Rails" height="140" width="110" /></a>
		</div>
		
		<h1 id="site_title"><span>Ruby on Rails</span></h1>
		<h2 id="site_title_tagline">Sustainable productivity for web-application development</h2>

		<ul id="navMain">
			<li class="first-child"><a href="http://www.rubyonrails.org/" title="Ruby on Rails" class="ruby_on_rails">Ruby on Rails</a></li>
			<li><a class="manuals" href="index.html" title="Manuals Index">Guides Index</a></li>
		</ul>
	</div>

	<div id="container">
		
		<div id="sidebar">
			<h2>Chapters</h2>
			<ol>
					<li>
					<a href="#_this_guide_assumes">This Guide Assumes</a>
					</li>
					<li>
					<a href="#_what_is_rails">What is Rails?</a>
						<ul>
						
							<li><a href="#_the_mvc_architecture">The MVC Architecture</a></li>
						
							<li><a href="#_the_components_of_rails">The Components of Rails</a></li>
						
							<li><a href="#_rest">REST</a></li>
						
						</ul>
					</li>
					<li>
					<a href="#_creating_a_new_rails_project">Creating a New Rails Project</a>
						<ul>
						
							<li><a href="#_installing_rails">Installing Rails</a></li>
						
							<li><a href="#_creating_the_blog_application">Creating the Blog Application</a></li>
						
							<li><a href="#_configuring_a_database">Configuring a Database</a></li>
						
						</ul>
					</li>
					<li>
					<a href="#_hello_rails">Hello, Rails!</a>
						<ul>
						
							<li><a href="#_starting_up_the_web_server">Starting up the Web Server</a></li>
						
							<li><a href="#_setting_the_application_home_page">Setting the Application Home Page</a></li>
						
						</ul>
					</li>
					<li>
					<a href="#_getting_up_and_running_quickly_with_scaffolding">Getting Up and Running Quickly With Scaffolding</a>
					</li>
					<li>
					<a href="#_creating_a_resource">Creating a Resource</a>
						<ul>
						
							<li><a href="#_running_a_migration">Running a Migration</a></li>
						
							<li><a href="#_adding_a_link">Adding a Link</a></li>
						
							<li><a href="#_working_with_posts_in_the_browser">Working with Posts in the Browser</a></li>
						
							<li><a href="#_the_model">The Model</a></li>
						
							<li><a href="#_adding_some_validation">Adding Some Validation</a></li>
						
							<li><a href="#_using_the_console">Using the Console</a></li>
						
							<li><a href="#_listing_all_posts">Listing All Posts</a></li>
						
							<li><a href="#_customizing_the_layout">Customizing the Layout</a></li>
						
							<li><a href="#_creating_new_posts">Creating New Posts</a></li>
						
							<li><a href="#_showing_an_individual_post">Showing an Individual Post</a></li>
						
							<li><a href="#_editing_posts">Editing Posts</a></li>
						
							<li><a href="#_destroying_a_post">Destroying a Post</a></li>
						
						</ul>
					</li>
					<li>
					<a href="#_drying_up_the_code">DRYing up the Code</a>
						<ul>
						
							<li><a href="#_using_partials_to_eliminate_view_duplication">Using Partials to Eliminate View Duplication</a></li>
						
							<li><a href="#_using_filters_to_eliminate_controller_duplication">Using Filters to Eliminate Controller Duplication</a></li>
						
						</ul>
					</li>
					<li>
					<a href="#_adding_a_second_model">Adding a Second Model</a>
						<ul>
						
							<li><a href="#_generating_a_model">Generating a Model</a></li>
						
							<li><a href="#_associating_models">Associating Models</a></li>
						
							<li><a href="#_adding_a_route">Adding a Route</a></li>
						
							<li><a href="#_generating_a_controller">Generating a Controller</a></li>
						
							<li><a href="#_building_views">Building Views</a></li>
						
							<li><a href="#_hooking_comments_to_posts">Hooking Comments to Posts</a></li>
						
						</ul>
					</li>
					<li>
					<a href="#_what_s_next">What's Next?</a>
					</li>
					<li>
					<a href="#_changelog">Changelog</a>
					</li>
			</ol>
		</div>
		
		<div id="content">
				<h1>Getting Started With Rails</h1>
			<div id="preamble">
<div class="sectionbody">
<div class="para"><p>This guide covers getting up and running with Ruby on Rails.  After reading it, you should be familiar with:</p></div>
<div class="ilist"><ul>
<li>
<p>
Installing Rails, creating a new Rails application, and connecting your application to a database
</p>
</li>
<li>
<p>
The general layout of a Rails application
</p>
</li>
<li>
<p>
The basic principles of MVC (Model, View Controller) and RESTful design
</p>
</li>
<li>
<p>
How to quickly generate the starting pieces of a Rails application.
</p>
</li>
</ul></div>
</div>
</div>
<h2 id="_this_guide_assumes">1. This Guide Assumes</h2>
<div class="sectionbody">
<div class="para"><p>This guide is designed for beginners who want to get started with a Rails application from scratch. It does not assume that you have any prior experience with Rails. However, to get the most out of it, you need to have some prerequisites installed:</p></div>
<div class="ilist"><ul>
<li>
<p>
The <a href="http://www.ruby-lang.org/en/downloads/">Ruby</a> language
</p>
</li>
<li>
<p>
The <a href="http://rubyforge.org/frs/?group_id=126">RubyGems</a> packaging system
</p>
</li>
<li>
<p>
A working installation of <a href="http://www.sqlite.org/">SQLite</a> (preferred), <a href="http://www.mysql.com/">MySQL</a>, or <a href="http://www.postgresql.org/">PostgreSQL</a>
</p>
</li>
</ul></div>
<div class="para"><p>It is highly recommended that you <strong>familiarize yourself with Ruby before diving into Rails</strong>. You will find it much easier to follow what's going on with a Rails application if you understand basic Ruby syntax. Rails isn't going to magically revolutionize the way you write web applications if you have no experience with the language it uses. There are some good free resources on the net for learning Ruby, including:</p></div>
<div class="ilist"><ul>
<li>
<p>
<a href="http://www.humblelittlerubybook.com/">Mr. Neigborlyâ€™s Humble Little Ruby Book</a>
</p>
</li>
<li>
<p>
<a href="http://www.rubycentral.com/book/">Programming Ruby</a>
</p>
</li>
<li>
<p>
<a href="http://poignantguide.net/ruby/">Why's (Poignant) Guide to Ruby</a>
</p>
</li>
</ul></div>
</div>
<h2 id="_what_is_rails">2. What is Rails?</h2>
<div class="sectionbody">
<div class="para"><p>Rails is a web development framework written in the Ruby language. It is designed to make programming web applications easier by making several assumptions about what every developer needs to get started. It allows you to write less code while accomplishing more than many other languages and frameworks. Longtime Rails developers also report that it makes web application development more fun.</p></div>
<div class="para"><p>Rails is <em>opinionated software</em>. That is, it assumes that there is a best way to do things, and it's designed to encourage that best way - and in some cases discourage alternatives. If you learn "The Rails Way" you'll probably discover a tremendous increase in productivity. If you persist in bringing old habits from other languages to your Rails development, and trying to use patterns you learned elsewhere, you may have a less happy experience.</p></div>
<div class="para"><p>The Rails philosophy includes several guiding principles:</p></div>
<div class="ilist"><ul>
<li>
<p>
DRY - "Don't Repeat Yourself" - suggests that writing the same code over and over again is a bad thing.
</p>
</li>
<li>
<p>
Convention Over Configuration - means that Rails makes assumptions about what you want to do and how you're going to do it, rather than letting you tweak every little thing through endless configuration files.
</p>
</li>
<li>
<p>
REST is the best pattern for web applications - organizing your application around resources and standard HTTP verbs is the fastest way to go.
</p>
</li>
</ul></div>
<h3 id="_the_mvc_architecture">2.1. The MVC Architecture</h3>
<div class="para"><p>Rails is organized around the Model, View, Controller architecture, usually just called MVC. MVC benefits include:</p></div>
<div class="ilist"><ul>
<li>
<p>
Isolation of business logic from the user interface
</p>
</li>
<li>
<p>
Ease of keeping code DRY
</p>
</li>
<li>
<p>
Making it clear where different types of code belong for easier maintenance
</p>
</li>
</ul></div>
<h4 id="_models">2.1.1. Models</h4>
<div class="para"><p>A model represents the information (data) of the application and the rules to manipulate that data. In the case of Rails, models are primarily used for managing the rules of interaction with a corresponding database table. In most cases, one table in your database will correspond to one model in your application. The bulk of your application's business logic will be concentrated in the models.</p></div>
<h4 id="_views">2.1.2. Views</h4>
<div class="para"><p>Views represent the user interface of your application. In Rails, views are often HTML files with embedded Ruby code that performs tasks related solely to the presentation of the data. Views handle the job of providing data to the web browser or other tool that is used to make requests from your application.</p></div>
<h4 id="_controllers">2.1.3. Controllers</h4>
<div class="para"><p>Controllers provide the "glue" between models and views. In Rails, controllers are responsible for processing the incoming requests from the web browser, interrogating the models for data, and passing that data on to the views for presentation.</p></div>
<h3 id="_the_components_of_rails">2.2. The Components of Rails</h3>
<div class="para"><p>Rails provides a full stack of components for creating web applications, including:</p></div>
<div class="ilist"><ul>
<li>
<p>
Action Controller
</p>
</li>
<li>
<p>
Action View
</p>
</li>
<li>
<p>
Active Record
</p>
</li>
<li>
<p>
Action Mailer
</p>
</li>
<li>
<p>
Active Resource
</p>
</li>
<li>
<p>
Railties
</p>
</li>
<li>
<p>
Active Support
</p>
</li>
</ul></div>
<h4 id="_action_controller">2.2.1. Action Controller</h4>
<div class="para"><p>Action Controller is the component that manages the controllers in a Rails application. The Action Controller framework processes incoming requests to a Rails application, extracts parameters, and dispatches them to the intended action. Services provided by Action Controller include session management, template rendering, and redirect management.</p></div>
<h4 id="_action_view">2.2.2. Action View</h4>
<div class="para"><p>Action View manages the views of your Rails application. It can create both HTML and XML output by default. Action View manages rendering templates, including nested and partial templates, and includes built-in AJAX support.</p></div>
<h4 id="_active_record">2.2.3. Active Record</h4>
<div class="para"><p>Active Record is the base for the models in a Rails application. It provides database independence, basic CRUD functionality, advanced finding capabilities, and the ability to relate models to one another, among other services.</p></div>
<h4 id="_action_mailer">2.2.4. Action Mailer</h4>
<div class="para"><p>Action Mailer is a framework for building e-mail services. You can use Action Mailer to send emails based on flexible templates, or to receive and process incoming email.</p></div>
<h4 id="_active_resource">2.2.5. Active Resource</h4>
<div class="para"><p>Active Resource provides a framework for managing the connection between business objects an RESTful web services. It implements a way to map web-based resources to local objects with CRUD semantics.</p></div>
<h4 id="_railties">2.2.6. Railties</h4>
<div class="para"><p>Railties is the core Rails code that builds new Rails applications and glues the various frameworks together in any Rails application.</p></div>
<h4 id="_active_support">2.2.7. Active Support</h4>
<div class="para"><p>Active Support is an extensive collection of utility classes and standard Ruby library extensions that are used in the Rails, both by the core code and by your applications.</p></div>
<h3 id="_rest">2.3. REST</h3>
<div class="para"><p>The foundation of the RESTful architecture is generally considered to be Roy Fielding's doctoral thesis, <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">Architectural Styles and the Design of Network-based Software Architectures</a>. Fortunately, you need not read this entire document to understand how REST works in Rails. REST, an acronym for Representational State Transfer, boils down to two main principles for our purposes:</p></div>
<div class="ilist"><ul>
<li>
<p>
Using resource identifiers (which, for the purposes of discussion, you can think of as URLs) to represent resources
</p>
</li>
<li>
<p>
Transferring representations of the state of that resource between system components.
</p>
</li>
</ul></div>
<div class="para"><p>For example, to a Rails application a request such as this:</p></div>
<div class="para"><p><tt>DELETE /photos/17</tt></p></div>
<div class="para"><p>would be understood to refer to a photo resource with the ID of 17, and to indicate a desired action - deleting that resource. REST is a natural style for the architecture of web applications, and Rails makes it even more natural by using conventions to shield you from some of the RESTful complexities.</p></div>
<div class="para"><p>If youâ€™d like more details on REST as an architectural style, these resources are more approachable than Fieldingâ€™s thesis:</p></div>
<div class="ilist"><ul>
<li>
<p>
<a href="http://www.infoq.com/articles/rest-introduction">A Brief Introduction to REST</a> by Stefan Tilkov
</p>
</li>
<li>
<p>
<a href="http://bitworking.org/news/373/An-Introduction-to-REST">An Introduction to REST</a> (video tutorial) by Joe Gregorio
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">Representational State Transfer</a> article in Wikipedia
</p>
</li>
</ul></div>
</div>
<h2 id="_creating_a_new_rails_project">3. Creating a New Rails Project</h2>
<div class="sectionbody">
<div class="para"><p>If you follow this guide, you'll create a Rails project called <tt>blog</tt>, a (very) simple weblog. Before you can start building the application, you need to make sure that you have Rails itself installed.</p></div>
<h3 id="_installing_rails">3.1. Installing Rails</h3>
<div class="para"><p>In most cases, the easiest way to install Rails is to take advantage of RubyGems:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ gem install rails
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">There are some special circumstances in which you might want to use an alternate installation strategy:</td>
</tr></table>
</div>
<div class="ilist"><ul>
<li>
<p>
If you're working on Windows, you may find it easier to install <a href="http://instantrails.rubyforge.org/wiki/wiki.pl">Instant Rails</a>. Be aware, though, that Instant Rails releases tend to lag seriously behind the actual Rails version. Also, you will find that Rails development on Windows is overall less pleasant than on other operating systems. If at all possible, we suggest that you install a Linux virtual machine and use that for Rails development, instead of using Windows.
</p>
</li>
<li>
<p>
If you want to keep up with cutting-edge changes to Rails, you'll want to clone the <a href="http://github.com/rails/rails/tree/master">Rails source code</a> from github. This is not recommended as an option for beginners, though.
</p>
</li>
</ul></div>
<h3 id="_creating_the_blog_application">3.2. Creating the Blog Application</h3>
<div class="para"><p>Open a terminal, navigate to a folder where you have rights to create files, and type:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rails blog
</tt></pre></div></div>
<div class="para"><p>This will create a Rails application that uses a SQLite database for data storage. If you prefer to use MySQL, run this command instead:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rails blog -d mysql
</tt></pre></div></div>
<div class="para"><p>And if you're using PostgreSQL for data storage, run this command:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rails blog -d postgresql
</tt></pre></div></div>
<div class="para"><p>In any case, Rails will create a folder in your working directory called <tt>blog</tt>. Open up that folder and explore its contents. Most of the work in this tutorial will happen in the <tt>app/</tt> folder, but here's a basic rundown on the function of each folder that Rails creates in a new application by default:</p></div>
<div class="tableblock">
<table rules="all"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="137" />
<col width="1440" />
<thead>
  <tr>
    <th align="left">
    File/Folder
    </th>
    <th align="left">
    Purpose
    </th>
  </tr>
</thead>
<tbody valign="top">
  <tr>
    <td align="left">
    <tt>README</tt>
    </td>
    <td align="left">
    This is a brief instruction manual for your application. Use it to tell others what your application does, how to set it up, and so on.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>Rakefile</tt>
    </td>
    <td align="left">
    This file contains batch jobs that can be run from the terminal.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>app/</tt>
    </td>
    <td align="left">
    Contains the controllers, models, and views for your application. You'll focus on this folder for the remainder of this guide.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>config/</tt>
    </td>
    <td align="left">
    Configure your application's runtime rules, routes, database, and more.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>db/</tt>
    </td>
    <td align="left">
    Shows your current database schema, as well as the database migrations. You'll learn about migrations shortly.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>doc/</tt>
    </td>
    <td align="left">
    In-depth documentation for your application.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>lib/</tt>
    </td>
    <td align="left">
    Extended modules for your application (not covered in this guide).
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>log/</tt>
    </td>
    <td align="left">
    Application log files.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>public/</tt>
    </td>
    <td align="left">
    The only folder seen to the world as-is.  This is where your images, javascript, stylesheets (CSS), and other static files go.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>script/</tt>
    </td>
    <td align="left">
    Scripts provided by Rails to do recurring tasks, such as benchmarking, plugin installation, and starting the console or the web server.
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>test/</tt>
    </td>
    <td align="left">
    Unit tests, fixtures, and other test apparatus. These are covered in <a href="../testing_rails_applications.html">Testing Rails Applications</a>
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>tmp/</tt>
    </td>
    <td align="left">
    Temporary files
    </td>
  </tr>
  <tr>
    <td align="left">
    <tt>vendor/</tt>
    </td>
    <td align="left">
    A place for third-party code. In a typical Rails application, this includes Ruby Gems, the Rails source code (if you install it into your project) and plugins containing additional prepackaged functionality.
    </td>
  </tr>
</tbody>
</table>
</div>
<h3 id="_configuring_a_database">3.3. Configuring a Database</h3>
<div class="para"><p>Just about every Rails application will interact with a database. The database to use is specified in a configuration file, <tt>config/database.yml</tt>.
If you open this file in a new Rails application, you'll see a default database configuration using SQLite. The file contains sections for three different environments in which Rails can run by default:</p></div>
<div class="ilist"><ul>
<li>
<p>
The <tt>development</tt> environment is used on your development computer as you interact manually with the application
</p>
</li>
<li>
<p>
The <tt>test</tt> environment is used to run automated tests
</p>
</li>
<li>
<p>
The <tt>production</tt> environment is used when you deploy your application for the world to use.
</p>
</li>
</ul></div>
<h4 id="_configuring_a_sqlite_database">3.3.1. Configuring a SQLite Database</h4>
<div class="para"><p>Rails comes with built-in support for <a href="http://www.sqlite.org/">SQLite</a>, which is a lightweight serverless database application. While a busy production environment may overload SQLite, it works well for development and testing. Rails defaults to using a SQLite database when creating a new project, but you can always change it later.</p></div>
<div class="para"><p>Here's the section of the default configuration file with connection information for the development environment:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>development<span style="color: #990000">:</span>
  adapter<span style="color: #990000">:</span> sqlite3
  database<span style="color: #990000">:</span> db<span style="color: #990000">/</span>development<span style="color: #990000">.</span>sqlite3
  timeout<span style="color: #990000">:</span> <span style="color: #993399">5000</span>
</tt></pre></div></div>
<div class="para"><p>If you don't have any database set up, SQLite is the easiest to get installed. If you're on OS X 10.5 or greater on a Mac, you already have it. Otherwise, you can install it using RubyGems:</p></div>
<div class="para"><p>If you're not running OS X 10.5 or greater, you'll need to install the SQLite gem.  Similar to installing Rails you just need to run:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ gem install sqlite3-ruby
</tt></pre></div></div>
<h4 id="_configuring_a_mysql_database">3.3.2. Configuring a MySQL Database</h4>
<div class="para"><p>If you choose to use MySQL, your <tt>config/database.yml</tt> will look a little different. Here's the development section:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>development<span style="color: #990000">:</span>
  adapter<span style="color: #990000">:</span> mysql
  encoding<span style="color: #990000">:</span> utf8
  database<span style="color: #990000">:</span> blog_development
  username<span style="color: #990000">:</span> root
  password<span style="color: #990000">:</span>
  socket<span style="color: #990000">:</span> <span style="color: #FF6600">/tmp/</span>mysql<span style="color: #990000">.</span>sock
</tt></pre></div></div>
<div class="para"><p>If your development computer's MySQL installation includes a root user with an empty password, this configuration should work for you. Otherwise, change the username and password in the <tt>development</tt> section as appropriate.</p></div>
<h4 id="_configuring_a_postgresql_database">3.3.3. Configuring a PostgreSQL Database</h4>
<div class="para"><p>If you choose to use PostgreSQL, your <tt>config/database.yml</tt> will be customized to use PostgreSQL databases:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>development<span style="color: #990000">:</span>
  adapter<span style="color: #990000">:</span> postgresql
  encoding<span style="color: #990000">:</span> unicode
  database<span style="color: #990000">:</span> blog_development
  username<span style="color: #990000">:</span> blog
  password<span style="color: #990000">:</span>
</tt></pre></div></div>
<div class="para"><p>Change the username and password in the <tt>development</tt> section as appropriate.</p></div>
</div>
<h2 id="_hello_rails">4. Hello, Rails!</h2>
<div class="sectionbody">
<div class="para"><p>One of the traditional places to start with a new language is by getting some text up on screen quickly. To do that in Rails, you need to create at minimum a controller and a view. Fortunately, you can do that in a single command. Enter this command in your terminal:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate controller home index
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">If you're on Windows, or your Ruby is set up in some non-standard fashion, you may need to explicitly pass Rails <tt>script</tt> commands to Ruby: <tt>ruby script/generate controller home index</tt>.</td>
</tr></table>
</div>
<div class="para"><p>Rails will create several files for you, including <tt>app/views/home/index.html.erb</tt>. This is the template that will be used to display the results of the <tt>index</tt> action (method) in the <tt>home</tt> controller. Open this file in your text editor and edit it to contain a single line of code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Hello, Rails!<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>
</tt></pre></div></div>
<h3 id="_starting_up_the_web_server">4.1. Starting up the Web Server</h3>
<div class="para"><p>You actually have a functional Rails application already - after running only two commands! To see it, you need to start a web server on your development machine. You can do this by running another command:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/server
</tt></pre></div></div>
<div class="para"><p>This will fire up the lightweight Webrick web server by default. To see your application in action, open a browser window and navigate to <tt>http://localhost:3000</tt>. You should see Rails' default information page:</p></div>
<div class="para"><p><span class="image">
<img src="images/rails_welcome.png" alt="Welcome Aboard screenshot" title="Welcome Aboard screenshot" />
</span></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">To stop the web server, hit Ctrl+C in the terminal window where it's running. In development mode, Rails does not generally require you to stop the server; changes you make in files will be automatically picked up by the server.</td>
</tr></table>
</div>
<div class="para"><p>The "Welcome Aboard" page is the smoke test for a new Rails application: it makes sure that you have your software configured correctly enough to serve a page. To view the page you just created, navigate to <tt>http://localhost:3000/home/index</tt>.</p></div>
<h3 id="_setting_the_application_home_page">4.2. Setting the Application Home Page</h3>
<div class="para"><p>You'd probably like to replace the "Welcome Aboard" page with your own application's home page. The first step to doing this is to delete the default page from your application:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rm public/index<span style="color: #990000">.</span>html
</tt></pre></div></div>
<div class="para"><p>Now, you have to tell Rails where your actual home page is located. Open the file <tt>config/routes.rb</tt> in your editor. This is your application's, <em>routing file</em>, which holds entries in a special DSL (domain-specific language) that tells Rails how to connect incoming requests to controllers and actions. At the bottom of the file you'll see the <em>default routes</em>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>map<span style="color: #990000">.</span>connect <span style="color: #FF0000">':controller/:action/:id'</span>
map<span style="color: #990000">.</span>connect <span style="color: #FF0000">':controller/:action/:id.:format'</span>
</tt></pre></div></div>
<div class="para"><p>The default routes handle simple requests such as <tt>/home/index</tt>: Rails translates that into a call to the <tt>index</tt> action in the <tt>home</tt> controller. As another example, <tt>/posts/edit/1</tt> would run the <tt>edit</tt> action in the <tt>posts</tt> controller with an <tt>id</tt> of 1.</p></div>
<div class="para"><p>To hook up your home page, you need to add another line to the routing file, above the default routes:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>map<span style="color: #990000">.</span>root <span style="color: #990000">:</span>controller <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"home"</span>
</tt></pre></div></div>
<div class="para"><p>This line illustrates one tiny bit of the "convention over configuration" approach: if you don't specify an action, Rails assumes the <tt>index</tt> action.</p></div>
<div class="para"><p>Now if you navigate to <tt>http://localhost:3000</tt> in your browser, you'll see the <tt>home/index</tt> view.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">For more information about routing, refer to <a href="../routing_outside_in.html">Rails Routing from the Outside In</a>.</td>
</tr></table>
</div>
</div>
<h2 id="_getting_up_and_running_quickly_with_scaffolding">5. Getting Up and Running Quickly With Scaffolding</h2>
<div class="sectionbody">
<div class="para"><p>Rails <em>scaffolding</em> is a quick way to generate some of the major pieces of an application. If you want to create the models, views, and controllers for a new resource in a single operation, scaffolding is the tool for the job.</p></div>
</div>
<h2 id="_creating_a_resource">6. Creating a Resource</h2>
<div class="sectionbody">
<div class="para"><p>In the case of the blog application, you can start by generating a scaffolded Post resource: this will represent a single blog posting. To do this, enter this command in your terminal:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate scaffold Post name<span style="color: #990000">:</span>string title<span style="color: #990000">:</span>string content<span style="color: #990000">:</span>text
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">While scaffolding will get you up and running quickly, the "one size fits all" code that it generates is unlikely to be a perfect fit for your application. In most cases, you'll need to customize the generated code. Many experienced Rails developers avoid scaffolding entirely, preferring to write all or most of their source code from scratch.</td>
</tr></table>
</div>
<div class="para"><p>The scaffold generator will build 13 files in your application, along with some folders, and edit one more. Here's a quick overview of what it creates:</p></div>
<div class="tableblock">
<table rules="all"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="525" />
<col width="1062" />
<thead>
  <tr>
    <th align="left">
    File
    </th>
    <th align="left">
    Purpose
    </th>
  </tr>
</thead>
<tbody valign="top">
  <tr>
    <td align="left">
    app/models/post.rb
    </td>
    <td align="left">
    The Post model
    </td>
  </tr>
  <tr>
    <td align="left">
    db/migrate/20081013124235_create_posts.rb
    </td>
    <td align="left">
    Migration to create the posts table in your database (your name will include a different timestamp)
    </td>
  </tr>
  <tr>
    <td align="left">
    app/views/posts/index.html.erb
    </td>
    <td align="left">
    A view to display an index of all posts
    </td>
  </tr>
  <tr>
    <td align="left">
    app/views/posts/show.html.erb
    </td>
    <td align="left">
    A view to display a single post
    </td>
  </tr>
  <tr>
    <td align="left">
    app/views/posts/new.html.erb
    </td>
    <td align="left">
    A view to create a new post
    </td>
  </tr>
  <tr>
    <td align="left">
    app/views/posts/edit.html.erb
    </td>
    <td align="left">
    A view to edit an existing post
    </td>
  </tr>
  <tr>
    <td align="left">
    app/views/layouts/posts.html.erb
    </td>
    <td align="left">
    A view to control the overall look and feel of the other posts views
    </td>
  </tr>
  <tr>
    <td align="left">
    public/stylesheets/scaffold.css
    </td>
    <td align="left">
    Cascading style sheet to make the scaffolded views look better
    </td>
  </tr>
  <tr>
    <td align="left">
    app/controllers/posts_controller.rb
    </td>
    <td align="left">
    The Posts controller
    </td>
  </tr>
  <tr>
    <td align="left">
    test/functional/posts_controller_test.rb
    </td>
    <td align="left">
    Functional testing harness for the posts controller
    </td>
  </tr>
  <tr>
    <td align="left">
    app/helpers/posts_helper.rb
    </td>
    <td align="left">
    Helper functions to be used from the posts views
    </td>
  </tr>
  <tr>
    <td align="left">
    config/routes.rb
    </td>
    <td align="left">
    Edited to include routing information for posts
    </td>
  </tr>
  <tr>
    <td align="left">
    test/fixtures/posts.yml
    </td>
    <td align="left">
    Dummy posts for use in testing
    </td>
  </tr>
  <tr>
    <td align="left">
    test/unit/post_test.rb
    </td>
    <td align="left">
    Unit testing harness for the posts model
    </td>
  </tr>
</tbody>
</table>
</div>
<h3 id="_running_a_migration">6.1. Running a Migration</h3>
<div class="para"><p>One of the products of the <tt>script/generate scaffold</tt> command is a <em>database migration</em>. Migrations are Ruby classes that are designed to make it simple to create and modify database tables. Rails uses rake commands to run migrations, and it's possible to undo a migration after it's been applied to your database. Migration filenames include a timestamp to ensure that they're processed in the order that they were created.</p></div>
<div class="para"><p>If you look in the <tt>db/migrate/20081013124235_create_posts.rb</tt> file (remember, yours will have a slightly different name), here's what you'll find:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreatePosts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>posts <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string <span style="color: #990000">:</span>name
      t<span style="color: #990000">.</span>string <span style="color: #990000">:</span>title
      t<span style="color: #990000">.</span>text <span style="color: #990000">:</span>content

      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>posts
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>If you were to translate that into words, it says something like: when this migration is run, create a table named <tt>posts</tt> with two string columns (<tt>name</tt> and <tt>title</tt>) and a text column (<tt>content</tt>), and generate timestamp fields to track record creation and updating. You can learn the detailed syntax for migrations in the <a href="../migrations.html">Rails Database Migrations</a> guide.</p></div>
<div class="para"><p>At this point, you need to do two things: create the database and run the migration. You can use rake commands at the terminal for both of those tasks:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rake db<span style="color: #990000">:</span>create
$ rake db<span style="color: #990000">:</span>migrate
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Because you're working in the development environment by default, both of these commands will apply to the database defined in the <tt>development</tt> section of your <tt>config/database.yml</tt> file.</td>
</tr></table>
</div>
<h3 id="_adding_a_link">6.2. Adding a Link</h3>
<div class="para"><p>To hook the posts up to the home page you've already created, you can add a link to the home page. Open <tt>/app/views/home/index.html.erb</tt> and modify it as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Hello<span style="color: #990000">,</span> Rails!<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;%= link_to "My Blog", posts_path %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>The <tt>link_to</tt> method is one of Rails' built-in view helpers. It creates a hyperlink based on text to display and where to go - in this case, to the path for posts.</p></div>
<h3 id="_working_with_posts_in_the_browser">6.3. Working with Posts in the Browser</h3>
<div class="para"><p>Now you're ready to start working with posts. To do that, navigate to <tt>http://localhost:3000</tt> and then click the "My Blog" link:</p></div>
<div class="para"><p><span class="image">
<img src="images/posts_index.png" alt="Posts Index screenshot" title="Posts Index screenshot" />
</span></p></div>
<div class="para"><p>This is the result of Rails rendering the <tt>index</tt> view of your posts. There aren't currently any posts in the database, but if you click the <tt>New Post</tt> link you can create one. After that, you'll find that you can edit posts, look at their details, or destroy them. All of the logic and HTML to handle this was built by the single <tt>script/generate scaffold</tt> command.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">In development mode (which is what you're working in by default), Rails reloads your application with every browser request, so there's no need to stop and restart the web server.</td>
</tr></table>
</div>
<div class="para"><p>Congratulations, you're riding the rails! Now it's time to see how it all works.</p></div>
<h3 id="_the_model">6.4. The Model</h3>
<div class="para"><p>The model file, <tt>app/models/post.rb</tt> is about as simple as it can get:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Post <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>There isn't much to this file - but note that the <tt>Post</tt> class inherits from <tt>ActiveRecord::Base</tt>. Active Record supplies a great deal of functionality to your Rails models for free, including basic database CRUD (Create, Read, Update, Destroy) operations, data validation, as well as sophisticated search support and the ability to relate multiple models to one another.</p></div>
<h3 id="_adding_some_validation">6.5. Adding Some Validation</h3>
<div class="para"><p>Rails includes methods to help you validate the data that you send to models. Open the <tt>app/models/post.rb</tt> file and edit it:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Post <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  validates_presence_of <span style="color: #990000">:</span>name<span style="color: #990000">,</span> <span style="color: #990000">:</span>title
  validates_length_of <span style="color: #990000">:</span>title<span style="color: #990000">,</span> <span style="color: #990000">:</span>minimum <span style="color: #990000">=&gt;</span> <span style="color: #993399">5</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>These changes will ensure that all posts have a name and a title, and that the title is at least five characters long. Rails can validate a variety of conditions in a model, including the presence or uniqueness of columns, their format, and the existence of associated objects.</p></div>
<h3 id="_using_the_console">6.6. Using the Console</h3>
<div class="para"><p>To see your validations in action, you can use the console. The console is a command-line tool that lets you execute Ruby code in the context of your application:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/console
</tt></pre></div></div>
<div class="para"><p>After the console loads, you can use it to work with your application's models:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;&gt;</span> p <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>create<span style="color: #990000">(:</span>content <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"A new post"</span><span style="color: #990000">)</span>
<span style="color: #990000">=&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">#&lt;Post id: nil, name: nil, title: nil, content: "A new post",</span></span>
created_at<span style="color: #990000">:</span> nil<span style="color: #990000">,</span> updated_at<span style="color: #990000">:</span> nil<span style="color: #990000">&gt;</span>
<span style="color: #990000">&gt;&gt;</span> p<span style="color: #990000">.</span>save
<span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span>
<span style="color: #990000">&gt;&gt;</span> p<span style="color: #990000">.</span>errors
<span style="color: #990000">=&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">#&lt;ActiveRecord::Errors:0x23bcf0c @base=#&lt;Post id: nil, name: nil,</span></span>
title<span style="color: #990000">:</span> nil<span style="color: #990000">,</span> content<span style="color: #990000">:</span> <span style="color: #FF0000">"A new post"</span><span style="color: #990000">,</span> created_at<span style="color: #990000">:</span> nil<span style="color: #990000">,</span> updated_at<span style="color: #990000">:</span> nil<span style="color: #990000">&gt;,</span>
@<span style="color: #009900">errors</span><span style="color: #990000">=</span>{<span style="color: #FF0000">"name"</span><span style="color: #990000">=&gt;[</span><span style="color: #FF0000">"can't be blank"</span><span style="color: #990000">],</span> <span style="color: #FF0000">"title"</span><span style="color: #990000">=&gt;[</span><span style="color: #FF0000">"can't be blank"</span><span style="color: #990000">,</span>
<span style="color: #FF0000">"is too short (minimum is 5 characters)"</span><span style="color: #990000">]</span>}<span style="color: #990000">&gt;</span>
</tt></pre></div></div>
<div class="para"><p>This code shows creating a new <tt>Post</tt> instance, attempting to save it and getting <tt>false</tt> for a return value (indicating that the save failed), and inspecting the <tt>errors</tt> of the post.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Unlike the development web server, the console does not automatically load your code afresh for each line. If you make changes, type <tt>reload!</tt> at the console prompt to load them.</td>
</tr></table>
</div>
<h3 id="_listing_all_posts">6.7. Listing All Posts</h3>
<div class="para"><p>The easiest place to start looking at functionality is with the code that lists all posts. Open the file <tt>app/controllers/posts_controller.rb </tt> and look at the <tt>index</tt> action:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> index
  <span style="color: #009900">@posts</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(:</span>all<span style="color: #990000">)</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="font-style: italic"><span style="color: #9A1900"># index.html.erb</span></span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@posts</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>This code sets the <tt>@posts</tt> instance variable to an array of all posts in the database. <tt>Post.find(:all)</tt> or <tt>Post.all</tt> calls the <tt>Post</tt> model to return all of the posts that are currently in the database, with no limiting conditions.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">For more information on finding records with Active Record, see <a href="../finders.html">Active Record Finders</a>.</td>
</tr></table>
</div>
<div class="para"><p>The <tt>respond_to</tt> block handles both HTML and XML calls to this action. If you browse to <tt>http://localhost:3000/posts.xml</tt>, you'll see all of the posts in XML format. The HTML format looks for a view in <tt>app/views/posts/</tt> with a name that corresponds to the action name. Rails makes all of the instance variables from the action available to the view. Here's <tt>app/view/posts/index.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Listing posts<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;table&gt;</span>
  <span style="color: #FF0000">&lt;tr&gt;</span>
    <span style="color: #FF0000">&lt;th&gt;</span>Name<span style="color: #FF0000">&lt;/th&gt;</span>
    <span style="color: #FF0000">&lt;th&gt;</span>Title<span style="color: #FF0000">&lt;/th&gt;</span>
    <span style="color: #FF0000">&lt;th&gt;</span>Content<span style="color: #FF0000">&lt;/th&gt;</span>
  <span style="color: #FF0000">&lt;/tr&gt;</span>

<span style="color: #FF0000">&lt;% for post in @posts %&gt;</span>
  <span style="color: #FF0000">&lt;tr&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%=h post.name %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%=h post.title %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%=h post.content %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%= link_to 'Show', post %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%= link_to 'Edit', edit_post_path(post) %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%= link_to 'Destroy', post, :confirm =&gt;</span> <span style="color: #FF0000">'Are you sure?'</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>method <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>delete <span style="color: #990000">%&gt;</span><span style="color: #FF0000">&lt;/td&gt;</span>
  <span style="color: #FF0000">&lt;/tr&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>
<span style="color: #FF0000">&lt;/table&gt;</span>

<span style="color: #FF0000">&lt;br /&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'New post', new_post_path %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>This view iterates over the contents of the <tt>@posts</tt> array to display content and links. A few things to note in the view:</p></div>
<div class="ilist"><ul>
<li>
<p>
<tt>h</tt> is a Rails helper method to sanitize displayed data, preventing cross-site scripting attacks
</p>
</li>
<li>
<p>
<tt>link_to</tt> builds a hyperlink to a particular destination
</p>
</li>
<li>
<p>
<tt>edit_post_path</tt> is a helper that Rails provides as part of RESTful routing. Youâ€™ll see a variety of these helpers for the different actions that the controller includes.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">For more details on the rendering process, see <a href="../layouts_and_rendering.html">Layouts and Rendering in Rails</a>.</td>
</tr></table>
</div>
<h3 id="_customizing_the_layout">6.8. Customizing the Layout</h3>
<div class="para"><p>The view is only part of the story of how HTML is displayed in your web browser. Rails also has the concept of <tt>layouts</tt>, which are containers for views. When Rails renders a view to the browser, it does so by putting the view's HTML into a layout's HTML. The <tt>script/generate scaffold</tt> command automatically created a default layout, <tt>app/views/layouts/posts.html.erb</tt>, for the posts. Open this layout in your editor and modify the <tt>body</tt> tag:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;!</span>DOCTYPE html PUBLIC <span style="color: #FF0000">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span>
       <span style="color: #FF0000">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span style="color: #990000">&gt;</span>

<span style="color: #FF0000">&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;</span>
<span style="color: #FF0000">&lt;head&gt;</span>
  <span style="color: #FF0000">&lt;meta http-equiv="content-type" content="text/html;charset=UTF-8" /&gt;</span>
  <span style="color: #FF0000">&lt;title&gt;</span>Posts<span style="color: #990000">:</span> <span style="color: #FF0000">&lt;%= controller.action_name %&gt;&lt;/title&gt;</span>
  <span style="color: #FF0000">&lt;%= stylesheet_link_tag 'scaffold' %&gt;</span>
<span style="color: #FF0000">&lt;/head&gt;</span>
<span style="color: #FF0000">&lt;body style="background: #EEEEEE;"&gt;</span>

<span style="color: #FF0000">&lt;p style="color: green"&gt;&lt;%= flash[:notice] %&gt;&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;%= yield  %&gt;</span>

<span style="color: #FF0000">&lt;/body&gt;</span>
<span style="color: #FF0000">&lt;/html&gt;</span>
</tt></pre></div></div>
<div class="para"><p>Now when you refresh the <tt>/posts</tt> page, you'll see a gray background to the page. This same gray background will be used throughout all the views for posts.</p></div>
<h3 id="_creating_new_posts">6.9. Creating New Posts</h3>
<div class="para"><p>Creating a new post involves two actions. The first is the <tt>new</tt> action, which instantiates an empty <tt>Post</tt> object:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>new

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="font-style: italic"><span style="color: #9A1900"># new.html.erb</span></span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>The <tt>new.html.erb</tt> view displays this empty Post to the user:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>New post<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;% form_for(@post) do |f| %&gt;</span>
  <span style="color: #FF0000">&lt;%= f.error_messages %&gt;</span>

  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :name %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :name %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :title %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :title %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :content %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_area :content %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.submit "Create" %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Back', posts_path %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>The <tt>form_for</tt> block is used to create an HTML form. Within this block, you have access to methods to build various controls on the form. For example, <tt>f.text_field :name</tt> tells Rails to create a text input on the form, and to hook it up to the <tt>name</tt> attribute of the instance being displayed. You can only use these methods with attributes of the model that the form is based on (in this case <tt>name</tt>, <tt>title</tt>, and <tt>content</tt>). Rails uses <tt>form_for</tt> in preference to having your write raw HTML because the code is more succinct, and because it explicitly ties the form to a particular model instance.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">If you need to create an HTML form that displays arbitrary fields, not tied to a model, you should use the <tt>form_tag</tt> method, which provides shortcuts for building forms that are not necessarily tied to a model instance.</td>
</tr></table>
</div>
<div class="para"><p>When the user clicks the <tt>Create</tt> button on this form, the browser will send information back to the <tt>create</tt> method of the controller (Rails knows to call the <tt>create</tt> method because the form is sent with an HTTP POST request; that's one of the conventions that I mentioned earlier):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> create
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>new<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post<span style="color: #990000">])</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>save
      flash<span style="color: #990000">[:</span>notice<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'Post was successfully created.'</span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> redirect_to<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">)</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>status <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>created<span style="color: #990000">,</span> <span style="color: #990000">:</span>location <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span> <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"new"</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>errors<span style="color: #990000">,</span> <span style="color: #990000">:</span>status <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>unprocessable_entity <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>The <tt>create</tt> action instantiates a new Post object from the data supplied by the user on the form, which Rails makes available in the <tt>params</tt> hash. After saving the new post, it uses <tt>flash[:notice]</tt> to create an informational message for the user, and redirects to the show action for the post. If there's any problem, the <tt>create</tt> action just shows the <tt>new</tt> view a second time, with any error messages.</p></div>
<div class="para"><p>Rails provides the <tt>flash</tt> hash (usually just called the Flash) so that messages can be carried over to another action, providing the user with useful information on the status of their request.  In the case of <tt>create</tt>, the user never actually sees any page rendered during the Post creation process, because it immediately redirects to the new Post as soon Rails saves the record. The Flash carries over a message to the next action, so that when the user is redirected back to the <tt>show</tt> action, they are presented with a message saying "Post was successfully created."</p></div>
<h3 id="_showing_an_individual_post">6.10. Showing an Individual Post</h3>
<div class="para"><p>When you click the <tt>show</tt> link for a post on the index page, it will bring you to a URL like <tt>http://localhost:3000/posts/1</tt>. Rails interprets this as a call to the <tt>show</tt> action for the resource, and passes in <tt>1</tt> as the <tt>:id</tt> parameter. Here's the <tt>show</tt> action:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="font-style: italic"><span style="color: #9A1900"># show.html.erb</span></span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>The <tt>show</tt> action uses <tt>Post.find</tt> to search for a single record in the database by its id value. After finding the record, Rails displays it by using <tt>show.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Name<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @post.name %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Title<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @post.title %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Content<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @post.content %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>


<span style="color: #FF0000">&lt;%= link_to 'Edit', edit_post_path(@post) %&gt;</span> <span style="color: #990000">|</span>
<span style="color: #FF0000">&lt;%= link_to 'Back', posts_path %&gt;</span>
</tt></pre></div></div>
<h3 id="_editing_posts">6.11. Editing Posts</h3>
<div class="para"><p>Like creating a new post, editing a post is a two-part process. The first step is a request to <tt>edit_post_path(@post)</tt> with a particular post. This calls the <tt>edit</tt> action in the controller:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>After finding the requested post, Rails uses the <tt>edit.html.erb</tt> view to display it:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Editing post<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;% form_for(@post) do |f| %&gt;</span>
  <span style="color: #FF0000">&lt;%= f.error_messages %&gt;</span>

  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :name %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :name %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :title %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :title %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :content %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_area :content %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.submit "Update" %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Show', @post %&gt;</span> <span style="color: #990000">|</span>
<span style="color: #FF0000">&lt;%= link_to 'Back', posts_path %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>Submitting the form created by this view will invoke the <tt>update</tt> action within the controller:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>update_attributes<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post<span style="color: #990000">])</span>
      flash<span style="color: #990000">[:</span>notice<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'Post was successfully updated.'</span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> redirect_to<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">)</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> head <span style="color: #990000">:</span>ok <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"edit"</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>errors<span style="color: #990000">,</span> <span style="color: #990000">:</span>status <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>unprocessable_entity <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>In the <tt>update</tt> action, Rails first uses the <tt>:id</tt> parameter passed back from the edit view to locate the database record that's being edited. The <tt>update_attributes</tt> call then takes the rest of the parameters from the request and applies them to this record. If all goes well, the user is redirected to the post's <tt>show</tt> view. If there are any problems, it's back to <tt>edit</tt> to correct them.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Sharp-eyed readers will have noticed that the <tt>form_for</tt> declaration is identical for the <tt>new</tt> and <tt>edit</tt> views. Rails generates different code for the two forms because it's smart enough to notice that in the one case it's being passed a new record that has never been saved, and in the other case an existing record that has already been saved to the database. In a production Rails application, you would ordinarily eliminate this duplication by moving identical code to a <em>partial template</em>, which you could then include in both parent templates. But the scaffold generator tries not to make too many assumptions, and generates code thatâ€™s easy to modify if you want different forms for <tt>create</tt> and <tt>edit</tt>.</td>
</tr></table>
</div>
<h3 id="_destroying_a_post">6.12. Destroying a Post</h3>
<div class="para"><p>Finally, clicking one of the <tt>destroy</tt> links sends the associated id to the <tt>destroy</tt> action:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="color: #009900">@post</span><span style="color: #990000">.</span>destroy

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> redirect_to<span style="color: #990000">(</span>posts_url<span style="color: #990000">)</span> <span style="color: #FF0000">}</span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> head <span style="color: #990000">:</span>ok <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>The <tt>destroy</tt> method of an Active Record model instance removes the corresponding record from the database. After that's done, there isn't any record to display, so Rails redirects the user's browser to the index view for the model.</p></div>
</div>
<h2 id="_drying_up_the_code">7. DRYing up the Code</h2>
<div class="sectionbody">
<div class="para"><p>At this point, itâ€™s worth looking at some of the tools that Rails provides to eliminate duplication in your code. In particular, you can use <em>partials</em> to clean up duplication in views and <em>filters</em> to help with duplication in controllers.</p></div>
<h3 id="_using_partials_to_eliminate_view_duplication">7.1. Using Partials to Eliminate View Duplication</h3>
<div class="para"><p>As you saw earlier, the scaffold-generated views for the <tt>new</tt> and <tt>edit</tt> actions are largely identical. You can pull the shared code out into a <tt>partial</tt> template. This requires editing the new and edit views, and adding a new template:</p></div>
<div class="para"><p><tt>new.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>New post<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;%= render :partial =&gt;</span> <span style="color: #FF0000">"form"</span> <span style="color: #990000">%&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Back', posts_path %&gt;</span>
</tt></pre></div></div>
<div class="para"><p><tt>edit.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Editing post<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;%= render :partial =&gt;</span> <span style="color: #FF0000">"form"</span> <span style="color: #990000">%&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Show', @post %&gt;</span> <span style="color: #990000">|</span>
<span style="color: #FF0000">&lt;%= link_to 'Back', posts_path %&gt;</span>
</tt></pre></div></div>
<div class="para"><p><tt>_form.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;% form_for(@post) do |f| %&gt;</span>
  <span style="color: #FF0000">&lt;%= f.error_messages %&gt;</span>

  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :name %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :name %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :title, "title" %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :title %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :content %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_area :content %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.submit "Save" %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>Now, when Rails renders the <tt>new</tt> or <tt>edit</tt> view, it will insert the <tt>_form</tt> partial at the indicated point. Note the naming convention for partials: if you refer to a partial named <tt>form</tt> inside of a view, the corresponding file is <tt>_form.html.erb</tt>, with a leading underscore.</p></div>
<div class="para"><p>For more information on partials, refer to the <a href="../layouts_and_rendering.html">Layouts and Rending in Rails</a> guide.</p></div>
<h3 id="_using_filters_to_eliminate_controller_duplication">7.2. Using Filters to Eliminate Controller Duplication</h3>
<div class="para"><p>At this point, if you look at the controller for posts, youâ€™ll see some duplication:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> PostsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
        <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>Four instances of the exact same line of code doesnâ€™t seem very DRY. Rails provides <em>filters</em> as a way to address this sort of repeated code. In this case, you can DRY things up by using a <tt>before_filter</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> PostsController <span style="color: #990000">&lt;</span> ApplicationController
  before_filter <span style="color: #990000">:</span>find_post<span style="color: #990000">,</span> <span style="color: #990000">:</span>only <span style="color: #990000">=&gt;</span> <span style="color: #990000">[:</span>show<span style="color: #990000">,</span> <span style="color: #990000">:</span>edit<span style="color: #990000">,</span> <span style="color: #990000">:</span>update<span style="color: #990000">,</span> <span style="color: #990000">:</span>destroy<span style="color: #990000">]</span>
  <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
        <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  private
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> find_post
      <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>Rails runs <em>before filters</em> before any action in the controller. You can use the <tt>:only</tt> clause to limit a before filter to only certain actions, or an <tt>:except</tt> clause to specifically skip a before filter for certain actions. Rails also allows you to define <em>after filters</em> that run after processing an action, as well as <em>around filters</em> that surround the processing of actions. Filters can also be defined in external classes to make it easy to share them between controllers.</p></div>
<div class="para"><p>For more information on filters, see the <a href="actioncontroller_basics.html">Action Controller Basics</a> guide.</p></div>
</div>
<h2 id="_adding_a_second_model">8. Adding a Second Model</h2>
<div class="sectionbody">
<div class="para"><p>Now that you've seen what's in a model built with scaffolding, it's time to add a second model to the application. The second model will handle comments on blog posts.</p></div>
<h3 id="_generating_a_model">8.1. Generating a Model</h3>
<div class="para"><p>Models in Rails use a singular name, and their corresponding database tables use a plural name. For the model to hold comments, the convention is to use the name Comment. Even if you don't want to use the entire apparatus set up by scaffolding, most Rails developers still use generators to make things like models and controllers. To create the new model, run this command in your terminal:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate model Comment commenter<span style="color: #990000">:</span>string body<span style="color: #990000">:</span>text post<span style="color: #990000">:</span>references
</tt></pre></div></div>
<div class="para"><p>This command will generate four files:</p></div>
<div class="ilist"><ul>
<li>
<p>
<tt>app/models/comment.rb</tt> - The model
</p>
</li>
<li>
<p>
+db/migrate/20081013214407_create_comments.rb - The migration
</p>
</li>
<li>
<p>
<tt>test/unit/comment_test.rb</tt> and <tt>test/fixtures/comments.yml</tt> - The test harness.
</p>
</li>
</ul></div>
<div class="para"><p>First, take a look at <tt>comment.rb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Comment <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>post
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>This is very similar to the <tt>post.rb</tt> model that you saw earlier. The difference is the line <tt>belongs_to :post</tt>, which sets up an Active Record <em>association</em>. You'll learn a little about associations in the next section of this guide.</p></div>
<div class="para"><p>In addition to the model, Rails has also made a migration to create the corresponding database table:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreateComments <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>comments <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string <span style="color: #990000">:</span>commenter
      t<span style="color: #990000">.</span>text <span style="color: #990000">:</span>body
      t<span style="color: #990000">.</span>references <span style="color: #990000">:</span>post

      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>comments
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>The <tt>t.references</tt> line sets up a foreign key column for the association between the two models. Go ahead and run the migration:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rake db<span style="color: #990000">:</span>migrate
</tt></pre></div></div>
<div class="para"><p>Rails is smart enough to only execute the migrations that have not already been run against this particular database.</p></div>
<h3 id="_associating_models">8.2. Associating Models</h3>
<div class="para"><p>Active Record associations let you easily declare the relationship between two models. In the case of comments and posts, you could write out the relationships this way:</p></div>
<div class="ilist"><ul>
<li>
<p>
Each comment belongs to one post
</p>
</li>
<li>
<p>
One post can have many comments
</p>
</li>
</ul></div>
<div class="para"><p>In fact, this is very close to the syntax that Rails uses to declare this association. You've already seen the line of code inside the Comment model that makes each comment belong to a Post:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Comment <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>post
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>You'll need to edit the <tt>post.rb</tt> file to add the other side of the association:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Post <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  validates_presence_of <span style="color: #990000">:</span>name<span style="color: #990000">,</span> <span style="color: #990000">:</span>title
  validates_length_of <span style="color: #990000">:</span>title<span style="color: #990000">,</span> <span style="color: #990000">:</span>minimum <span style="color: #990000">=&gt;</span> <span style="color: #993399">5</span>
  has_many <span style="color: #990000">:</span>comments
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>These two declarations enable a good bit of automatic behavior. For example, if you have an instance variable <tt>@post</tt> containing a post, you can retrieve all the comments belonging to that post as the array <tt>@post.comments</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">For more information on Active Record associations, see the <a href="../association_basics.html">Active Record Associations</a> guide.</td>
</tr></table>
</div>
<h3 id="_adding_a_route">8.3. Adding a Route</h3>
<div class="para"><p><em>Routes</em> are entries in the <tt>config/routes.rb</tt> file that tell Rails how to match incoming HTTP requests to controller actions. Open up that file and find the existing line referring to <tt>posts</tt>. Then edit it as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>map<span style="color: #990000">.</span>resources <span style="color: #990000">:</span>posts <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>post<span style="color: #990000">|</span>
  post<span style="color: #990000">.</span>resources <span style="color: #990000">:</span>comments
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>This creates <tt>comments</tt> as a <em>nested resource</em> within <tt>posts</tt>. This is another part of capturing the hierarchical relationship that exists between posts and comments.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">For more information on routing, see the <a href="../routing_outside_in">Rails Routing from the Outside In</a> guide.</td>
</tr></table>
</div>
<h3 id="_generating_a_controller">8.4. Generating a Controller</h3>
<div class="para"><p>With the model in hand, you can turn your attention to creating a matching controller. Again, there's a generator for this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate controller Comments index show new edit
</tt></pre></div></div>
<div class="para"><p>This creates seven files:</p></div>
<div class="ilist"><ul>
<li>
<p>
<tt>app/controllers/comments_controller.rb</tt> - The controller
</p>
</li>
<li>
<p>
<tt>app/helpers/comments_helper.rb</tt> - A view helper file
</p>
</li>
<li>
<p>
<tt>app/views/comments/index.html.erb</tt> - The view for the index action
</p>
</li>
<li>
<p>
<tt>app/views/comments/show.html.erb</tt> - The view for the show action
</p>
</li>
<li>
<p>
<tt>app/views/comments/new.html.erb</tt> - The view for the new action
</p>
</li>
<li>
<p>
<tt>app/views/comments/edit.html.erb</tt> - The view for the edit action
</p>
</li>
<li>
<p>
<tt>test/functional/comments_controller_test.rb</tt> - The functional tests for the controller
</p>
</li>
</ul></div>
<div class="para"><p>The controller will be generated with empty methods for each action that you specified in the call to <tt>script/generate controller</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CommentsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> index
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>You'll need to flesh this out with code to actually process requests appropriately in each method. Here's a version that (for simplicity's sake) only responds to requests that require HTML:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CommentsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> index
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comments</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> Comment<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>build
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> create
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>build<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>comment<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@comment</span><span style="color: #990000">.</span>save
      redirect_to post_comment_path<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">,</span> <span style="color: #009900">@comment</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"new"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> Comment<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> Comment<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@comment</span><span style="color: #990000">.</span>update_attributes<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>comment<span style="color: #990000">])</span>
      redirect_to post_comment_path<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">,</span> <span style="color: #009900">@comment</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"edit"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="para"><p>You'll see a bit more complexity here than you did in the controller for posts. That's a side-effect of the nesting that you've set up; each request for a comment has to keep track of the post to which the comment is attached.</p></div>
<div class="para"><p>In addition, the code takes advantage of some of the methods available for an association. For example, in the <tt>new</tt> method, it calls</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>build
</tt></pre></div></div>
<div class="para"><p>This creates a new <tt>Comment</tt> object <em>and</em> sets up the <tt>post_id</tt> field to have the <tt>id</tt> from the specified <tt>Post</tt> object in a single operation.</p></div>
<h3 id="_building_views">8.5. Building Views</h3>
<div class="para"><p>Because you skipped scaffolding, you'll need to build views for comments "by hand." Invoking <tt>script/generate controller</tt> will give you skeleton views, but they'll be devoid of actual content. Here's a first pass at fleshing out the comment views.</p></div>
<div class="para"><p>The <tt>index.html.erb</tt> view:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Comments <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #FF0000">&lt;%= @post.title %&gt;&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;table&gt;</span>
  <span style="color: #FF0000">&lt;tr&gt;</span>
    <span style="color: #FF0000">&lt;th&gt;</span>Commenter<span style="color: #FF0000">&lt;/th&gt;</span>
    <span style="color: #FF0000">&lt;th&gt;</span>Body<span style="color: #FF0000">&lt;/th&gt;</span>
  <span style="color: #FF0000">&lt;/tr&gt;</span>

<span style="color: #FF0000">&lt;% for comment in @comments %&gt;</span>
  <span style="color: #FF0000">&lt;tr&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%=h comment.commenter %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%=h comment.body %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%= link_to 'Show', post_comment_path(@post, comment) %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%= link_to 'Edit', edit_post_comment_path(@post, comment) %&gt;&lt;/td&gt;</span>
    <span style="color: #FF0000">&lt;td&gt;&lt;%= link_to 'Destroy', post_comment_path(@post, comment), :confirm =&gt;</span> <span style="color: #FF0000">'Are you sure?'</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>method <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>delete <span style="color: #990000">%&gt;</span><span style="color: #FF0000">&lt;/td&gt;</span>
  <span style="color: #FF0000">&lt;/tr&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>
<span style="color: #FF0000">&lt;/table&gt;</span>

<span style="color: #FF0000">&lt;br /&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'New comment', new_post_comment_path(@post) %&gt;</span>
<span style="color: #FF0000">&lt;%= link_to 'Back to Post', @post %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>The <tt>new.html.erb</tt> view:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>New comment<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;% form_for([@post, @comment]) do |f| %&gt;</span>
  <span style="color: #FF0000">&lt;%= f.error_messages %&gt;</span>

  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :commenter %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :commenter %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :body %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_area :body %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.submit "Create" %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Back', post_comments_path(@post) %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>The <tt>show.html.erb</tt> view:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Comment on <span style="color: #FF0000">&lt;%= @post.title %&gt;&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Commenter<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @comment.commenter %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Comment<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @comment.body %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Edit', edit_post_comment_path(@post, @comment) %&gt;</span> <span style="color: #990000">|</span>
<span style="color: #FF0000">&lt;%= link_to 'Back', post_comments_path(@post) %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>The <tt>edit.html.erb</tt> view:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Editing comment<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;% form_for([@post, @comment]) do |f| %&gt;</span>
  <span style="color: #FF0000">&lt;%= f.error_messages %&gt;</span>

  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :commenter %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_field :commenter %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.label :body %&gt;&lt;br /&gt;</span>
    <span style="color: #FF0000">&lt;%= f.text_area :body %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
  <span style="color: #FF0000">&lt;p&gt;</span>
    <span style="color: #FF0000">&lt;%= f.submit "Update" %&gt;</span>
  <span style="color: #FF0000">&lt;/p&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Show', post_comment_path(@post, @comment) %&gt;</span> <span style="color: #990000">|</span>
<span style="color: #FF0000">&lt;%= link_to 'Back', post_comments_path(@post) %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>Again, the added complexity here (compared to the views you saw for managing comments) comes from the necessity of juggling a post and its comments at the same time.</p></div>
<h3 id="_hooking_comments_to_posts">8.6. Hooking Comments to Posts</h3>
<div class="para"><p>As a final step, I'll modify the <tt>show.html.erb</tt> view for a post to show the comments on that post, and to allow managing those comments:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Name<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @post.name %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Title<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @post.title %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;p&gt;</span>
  <span style="color: #FF0000">&lt;b&gt;</span>Content<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
  <span style="color: #FF0000">&lt;%=h @post.content %&gt;</span>
<span style="color: #FF0000">&lt;/p&gt;</span>

<span style="color: #FF0000">&lt;h2&gt;</span>Comments<span style="color: #FF0000">&lt;/h2&gt;</span>
<span style="color: #FF0000">&lt;% @post.comments.each do |c| %&gt;</span>
        <span style="color: #FF0000">&lt;p&gt;</span>
          <span style="color: #FF0000">&lt;b&gt;</span>Commenter<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
          <span style="color: #FF0000">&lt;%=h c.commenter %&gt;</span>
        <span style="color: #FF0000">&lt;/p&gt;</span>

        <span style="color: #FF0000">&lt;p&gt;</span>
          <span style="color: #FF0000">&lt;b&gt;</span>Comment<span style="color: #990000">:</span><span style="color: #FF0000">&lt;/b&gt;</span>
          <span style="color: #FF0000">&lt;%=h c.body %&gt;</span>
        <span style="color: #FF0000">&lt;/p&gt;</span>
<span style="color: #FF0000">&lt;% end %&gt;</span>

<span style="color: #FF0000">&lt;%= link_to 'Edit', edit_post_path(@post) %&gt;</span> <span style="color: #990000">|</span>
<span style="color: #FF0000">&lt;%= link_to 'Back', posts_path %&gt;</span>
<span style="color: #FF0000">&lt;%= link_to 'Manage Comments', post_comments_path(@post) %&gt;</span>
</tt></pre></div></div>
<div class="para"><p>Note that each post has its own individual comments collection, accessible as <tt>@post.comments</tt>. That's a consequence of the declarative associations in the models. Path helpers such as <tt>post_comments_path</tt> come from the nested route declaration in <tt>config/routes.rb</tt>.</p></div>
</div>
<h2 id="_what_s_next">9. What's Next?</h2>
<div class="sectionbody">
<div class="para"><p>Now that you've seen your first Rails application, you should feel free to update it and experiment on your own. But you don't have to do everything without help. As you need assistance getting up and running with Rails, feel free to consult these support resources:</p></div>
<div class="ilist"><ul>
<li>
<p>
The <a href="http://manuals.rubyonrails.org/">Ruby On Rails guides</a>
</p>
</li>
<li>
<p>
The <a href="http://groups.google.com/group/rubyonrails-talk">Ruby on Rails mailing list</a>
</p>
</li>
<li>
<p>
The #rubyonrails channel on irc.freenode.net
</p>
</li>
<li>
<p>
The <a href="http://wiki.rubyonrails.org/rails">Rails wiki</a>
</p>
</li>
</ul></div>
<div class="para"><p>Rails also comes with built-in help that you can generate using the rake command-line utility:</p></div>
<div class="ilist"><ul>
<li>
<p>
Running <tt>rake doc:guides</tt> will put a full copy of the Rails Guides in the <tt>/doc/guides</tt> folder of your application. Open <tt>/doc/guides/index.html</tt> in your web browser to explore the Guides.
</p>
</li>
<li>
<p>
Running <tt>rake doc:rails</tt> will put a full copy of the API documentation for Rails in the <tt>/doc/api</tt> folder of your application. Open <tt>/doc/api/index.html</tt> in your web browser to explore the API documentation.
</p>
</li>
</ul></div>
</div>
<h2 id="_changelog">10. Changelog</h2>
<div class="sectionbody">
<div class="para"><p><a href="http://rails.lighthouseapp.com/projects/16213-rails-guides/tickets/2">Lighthouse ticket</a></p></div>
<div class="ilist"><ul>
<li>
<p>
November 3, 2008: Formatting patch from Dave Rothlisberger
</p>
</li>
<li>
<p>
November 1, 2008: First approved version by <a href="../authors.html#mgunderloy">Mike Gunderloy</a>
</p>
</li>
<li>
<p>
October 16, 2008: Revised based on feedback from Pratik Naik by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
October 13, 2008: First complete draft by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
October 12, 2008: More detail, rearrangement, editing by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
September 8, 2008: initial version by James Miller (not yet approved for publication)
</p>
</li>
</ul></div>
</div>

		</div>
	</div>
</body>
</html>
